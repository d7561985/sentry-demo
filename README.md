# Sentry POC - iGaming Platform

–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π Sentry –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã iGaming –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

## üöÄ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∑–∞–ø—É—Å–∫—É

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Sentry

1. **–°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –≤ Sentry** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç):
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://sentry.io
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ

2. **–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç—ã –≤ Sentry**:
   - –í Sentry Dashboard –Ω–∞–∂–º–∏—Ç–µ "Create Project"
   - –°–æ–∑–¥–∞–π—Ç–µ 5 –ø—Ä–æ–µ–∫—Ç–æ–≤ (–ø–æ –æ–¥–Ω–æ–º—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞):
     - `igaming-frontend` (Platform: Browser/JavaScript)
     - `igaming-gateway` (Platform: Go)
     - `igaming-user` (Platform: Go)
     - `igaming-game` (Platform: Python)
     - `igaming-payment` (Platform: Node.js)

3. **–ü–æ–ª—É—á–∏—Ç–µ DSN –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞**:
   - –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞–∂–¥—ã–π –ø—Ä–æ–µ–∫—Ç
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings ‚Üí Client Keys (DSN)
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ DSN (—Ñ–æ—Ä–º–∞—Ç: `https://xxxxx@o123456.ingest.sentry.io/1234567`)

4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ**:
   ```bash
   cp .env.example .env
   ```
   
   –û—Ç–∫—Ä–æ–π—Ç–µ `.env` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ DSN:
   ```
   SENTRY_FRONTEND_DSN=https://YOUR_KEY@o123456.ingest.sentry.io/1234567
   SENTRY_GATEWAY_DSN=https://YOUR_KEY@o123456.ingest.sentry.io/1234568
   SENTRY_USER_DSN=https://YOUR_KEY@o123456.ingest.sentry.io/1234569
   SENTRY_GAME_DSN=https://YOUR_KEY@o123456.ingest.sentry.io/1234570
   SENTRY_PAYMENT_DSN=https://YOUR_KEY@o123456.ingest.sentry.io/1234571
   ```

### 2. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
./start.sh

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ docker-compose
docker-compose up -d
```

–î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (–æ–∫–æ–ª–æ 30 —Å–µ–∫—É–Ω–¥).

## üìä Scenario 1: Distributed Tracing Demo

### –¶–µ–ª—å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
–ü–æ–∫–∞–∑–∞—Ç—å –∫–∞–∫ Sentry –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ –≤—Å—é —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É, –≤—ã—è–≤–ª—è–µ—Ç —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ –∏ –ø–æ–º–æ–≥–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã.

### –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

#### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–µ–º–æ
1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: http://localhost:4200
2. –í—ã —É–≤–∏–¥–∏—Ç–µ –ø—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–ª–æ—Ç-–º–∞—à–∏–Ω—ã —Å –±–∞–ª–∞–Ω—Å–æ–º $1000

#### 2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–∏–Ω–æ–≤
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **SPIN ($10)** 5-10 —Ä–∞–∑
2. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–ø–∏–Ω—ã –±—É–¥—É—Ç –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –æ—à–∏–±–∫–æ–π (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - 10% –æ—à–∏–±–æ–∫ –≤—Å—Ç—Ä–æ–µ–Ω–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ)

#### 3. –û—Ç–∫—Ä–æ–π—Ç–µ Sentry Dashboard
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ https://sentry.io
2. –û—Ç–∫—Ä–æ–π—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –∏ –ø—Ä–æ–µ–∫—Ç `igaming-frontend`

#### 4. –ò–∑—É—á–∏—Ç–µ Performance —Ä–∞–∑–¥–µ–ª
1. –í –ª–µ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ **Performance**
2. –ù–∞–π–¥–∏—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é `slot-machine-spin`
3. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –Ω–µ—ë –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π

### üîç –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å

#### A. –ü–æ–ª–Ω—ã–π Distributed Trace
**–ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å**: Performance ‚Üí Transaction Details ‚Üí Trace View

**–ß—Ç–æ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å**:
- "–í–∏–¥–∏–º –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ 5 –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤"
- "–ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–≤–æ–π span –≤ –æ–±—â–∏–π trace"
- "–ú–æ–∂–µ–º —Ç–æ—á–Ω–æ –≤–∏–¥–µ—Ç—å, –≥–¥–µ —Ç—Ä–∞—Ç–∏—Ç—Å—è –≤—Ä–µ–º—è"

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏**:
- –û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ~3-6 —Å–µ–∫—É–Ω–¥
- –û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: Payment Service (2-5 —Å–µ–∫)

#### B. –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**1. –ú–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤ User Service**
- **–ì–¥–µ**: Span `db.query` "Find user by ID"
- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 500ms+
- **–†–∞—Å—Å–∫–∞–∑–∞—Ç—å**: "–í–∏–¥–∏–º –º–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ MongoDB - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–Ω–¥–µ–∫—Å. –í —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ —ç—Ç–æ –±—ã–ª–æ –±—ã –∫—Ä–∏—Ç–∏—á–Ω–æ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ"

**2. CPU Spike –≤ Game Engine**
- **–ì–¥–µ**: Span `game.rng` "Calculate slot result"
- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –í–∞—Ä—å–∏—Ä—É–µ—Ç—Å—è
- **–†–∞—Å—Å–∫–∞–∑–∞—Ç—å**: "–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á–µ—Ç–∞ RNG —Å–æ–∑–¥–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ CPU. Sentry –ø–æ–º–æ–≥–∞–µ—Ç –≤—ã—è–≤–∏—Ç—å —Ç–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã"

**3. –ú–µ–¥–ª–µ–Ω–Ω—ã–π –≤–Ω–µ—à–Ω–∏–π API –≤ Payment Service**
- **–ì–¥–µ**: Span `http.client` "External payment provider API"
- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 2-5 —Å–µ–∫—É–Ω–¥
- **–†–∞—Å—Å–∫–∞–∑–∞—Ç—å**: "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–Ω—ã–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º - —Å–∞–º–æ–µ —É–∑–∫–æ–µ –º–µ—Å—Ç–æ. –ù—É–∂–Ω–æ –ª–∏–±–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –ª–∏–±–æ —Å–¥–µ–ª–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π"

#### C. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ï—Å–ª–∏ –ø–æ–ø–∞–ª–∞—Å—å –æ—à–∏–±–∫–∞ –ø–ª–∞—Ç–µ–∂–∞**:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Issues** –≤ Sentry
2. –ù–∞–π–¥–∏—Ç–µ "Payment provider timeout"
3. **–ü–æ–∫–∞–∂–∏—Ç–µ**:
   - Stack trace —Å —Ç–æ—á–Ω—ã–º –º–µ—Å—Ç–æ–º –æ—à–∏–±–∫–∏
   - User context (ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
   - –°–≤—è–∑—å —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º trace
   - –ß–∞—Å—Ç–æ—Ç—É –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~10%)

#### D. Custom –º–µ—Ç—Ä–∏–∫–∏

**–ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å**: –í –¥–µ—Ç–∞–ª—è—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Å–µ–∫—Ü–∏—è Measurements

**–ü–æ–∫–∞–∑–∞—Ç—å**:
- `game.bet_amount` - —Ä–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏
- `game.payout` - –≤—ã–∏–≥—Ä—ã—à (–µ—Å–ª–∏ –±—ã–ª)
- `payment.processing_time` - –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞

**–†–∞—Å—Å–∫–∞–∑–∞—Ç—å**: "–ú–æ–∂–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏ –ø—Ä—è–º–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"

### üí° –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –¥–ª—è –¥–µ–º–æ

1. **MTTR (Mean Time To Resolution)**:
   - "–ë–µ–∑ Sentry: –ø–æ–∏—Å–∫ –ø—Ä–æ–±–ª–µ–º—ã –≤ 5 —Å–µ—Ä–≤–∏—Å–∞—Ö –∑–∞–Ω—è–ª –±—ã —á–∞—Å—ã"
   - "–° Sentry: –≤–∏–¥–∏–º –ø—Ä–æ–±–ª–µ–º—É –∑–∞ —Å–µ–∫—É–Ω–¥—ã"

2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**:
   - "–°—Ä–∞–∑—É –≤–∏–¥–Ω—ã –≤—Å–µ bottlenecks"
   - "–ú–æ–∂–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏"

3. **–ë–∏–∑–Ω–µ—Å-impact**:
   - "10% –æ—à–∏–±–æ–∫ –ø–ª–∞—Ç–µ–∂–µ–π = –ø—Ä—è–º–∞—è –ø–æ—Ç–µ—Ä—è revenue"
   - "–ú–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫ = –ø–æ—Ç–µ—Ä—è –∏–≥—Ä–æ–∫–æ–≤"

### üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–º–æ

#### N+1 Query Problem (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∫–∞–∑–∞—Ç—å N+1 –ø—Ä–æ–±–ª–µ–º—É:
1. –í –±—Ä–∞—É–∑–µ—Ä–µ –¥–æ–±–∞–≤—å—Ç–µ –∫ URL: `?include_history=true`
2. –°–¥–µ–ª–∞–π—Ç–µ —Å–ø–∏–Ω
3. –í Sentry —É–≤–∏–¥–∏—Ç–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ span'–æ–≤ `db.query.game`
4. –û–±—ä—è—Å–Ω–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

#### Panic –≤ Go —Å–µ—Ä–≤–∏—Å–µ
–î–ª—è –¥–µ–º–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–∞–Ω–∏–∫:
```bash
curl http://localhost:8080/api/v1/debug/panic/panic-test
```
–ü–æ–∫–∞–∂–µ—Ç –∫–∞–∫ Sentry –ª–æ–≤–∏—Ç –ø–∞–Ω–∏–∫—É –≤ Go.

## üõ† Troubleshooting

**–°–µ—Ä–≤–∏—Å—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è**:
```bash
docker-compose logs -f [service-name]
```

**–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ Sentry**:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DSN –≤ `.env`
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ 5 –ø—Ä–æ–µ–∫—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `tracesSampleRate: 1.0` –≤ –∫–æ–¥–µ

**–ù–µ–ø–æ–ª–Ω—ã–µ traces**:
- –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ —Å–ø–∏–Ω–∞
- –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ Sentry
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã: `docker-compose ps`